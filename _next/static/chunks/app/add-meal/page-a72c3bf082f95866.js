(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[998],{1176:(e,a,r)=>{Promise.resolve().then(r.bind(r,5686))},5686:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>m});var t=r(5155),o=r(2115),s=r(6046),i=r(6472),l=r(5781);let n="https://evolution-n8n.kxjqvi.easypanel.host/webhook/analyseImage";async function c(e,a){if(!n)throw Error("A URL da API n\xe3o est\xe1 configurada. Verifique as vari\xe1veis de ambiente.");try{let r=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e,text:a})});if(!r.ok){let e=await r.text();throw console.error("Erro ao se comunicar com a API N8N:",e),Error("Erro ao se comunicar com a API N8N.")}let t=await r.json();if(!t||!t.macronutrientes||!t.ingredientes)throw Error("Resposta inv\xe1lida da API N8N. Verifique o formato retornado.");return{calorias:t.calorias||0,macronutrientes:t.macronutrientes,ingredientes:t.ingredientes}}catch(e){throw console.error("Erro no servi\xe7o N8N:",e),Error("Erro ao processar a requisi\xe7\xe3o com a API externa.")}}var d=r(8223);function m(){let e=(0,s.useRouter)(),a=new Date().toISOString().slice(0,16),[r,l]=(0,o.useState)(()=>{let e=new Date().getHours();return e<10?"Caf\xe9 da manh\xe3":e<14?"Almo\xe7o":e<17?"Caf\xe9 da tarde":e<20?"Lanche":e<23?"Janta":"Beliscada"}),[n,m]=(0,o.useState)(a),[u,g]=(0,o.useState)(null),[h,b]=(0,o.useState)(null),[x,p]=(0,o.useState)(""),[f,y]=(0,o.useState)(0),[v,w]=(0,o.useState)({proteinas:0,carboidratos:0,gorduras:0}),[N,j]=(0,o.useState)(!1);(0,o.useEffect)(()=>{u||b(null)},[u]);let E=async(e,a)=>{let r=document.createElement("img"),t=document.createElement("canvas"),o=new FileReader;return new Promise((s,i)=>{o.onload=o=>{var l;r.src=null===(l=o.target)||void 0===l?void 0:l.result,r.onload=()=>{let o=a/r.width;t.width=a,t.height=r.height*o;let l=t.getContext("2d");null==l||l.drawImage(r,0,0,t.width,t.height),t.toBlob(a=>{if(!a)return i(Error("Erro ao redimensionar imagem."));s(new File([a],e.name,{type:e.type,lastModified:Date.now()}))},e.type,.8)}},o.onerror=e=>i(e),o.readAsDataURL(e)})},k=async e=>{var a,r;let t=null===(a=e.target.files)||void 0===a?void 0:a[0];if(t){j(!0);try{let e=await E(t,640);g(e),b(URL.createObjectURL(e));let a=await C(e),o=await c(a,"");y(o.calorias||0),w(o.macronutrientes||{proteinas:0,carboidratos:0,gorduras:0}),p((null===(r=o.ingredientes)||void 0===r?void 0:r.join(", "))||"")}catch(e){console.error("Erro ao processar imagem:",e),alert("Erro ao processar a imagem.")}finally{j(!1)}}},C=async e=>{try{let a="".concat(Date.now(),"-").concat(e.name),{data:r,error:t}=await d.N.storage.from("imagens_refeicoes").upload(a,e);if(t)throw Error(t.message);let{data:o}=d.N.storage.from("imagens_refeicoes").getPublicUrl(a);if(!o||!o.publicUrl)throw Error("Erro ao obter a URL p\xfablica da imagem.");return o.publicUrl}catch(e){throw console.error("Erro ao fazer upload da imagem:",e),e}},I=async()=>{if(x.trim()){j(!0);try{let e=await c("",x);y(e.calorias||0),w(e.macronutrientes||{proteinas:0,carboidratos:0,gorduras:0})}catch(e){console.error("Erro ao analisar os ingredientes:",e),alert("Erro ao analisar os ingredientes.")}finally{j(!1)}}},R=async()=>{try{let{data:{user:a},error:t}=await d.N.auth.getUser();if(t||!a)throw Error("Usu\xe1rio n\xe3o autenticado.");let{error:o}=await d.N.from("refeicoes").insert({usuario_id:a.id,tipo_refeicao:r,data_hora:n,ingredientes:x,calorias:f,proteinas:v.proteinas,carboidratos:v.carboidratos,gorduras:v.gorduras,url_imagem:h});if(o)throw Error(o.message);alert("Refei\xe7\xe3o salva com sucesso!"),e.push("/dashboard")}catch(e){console.error("Erro ao salvar refei\xe7\xe3o:",e),alert("Erro ao salvar a refei\xe7\xe3o.")}},S={labels:["Prote\xednas (g)","Carboidratos (g)","Gorduras (g)"],datasets:[{label:"Macronutrientes",data:[v.proteinas,v.carboidratos,v.gorduras],backgroundColor:["#4CAF50","#FFC107","#FF5722"],borderRadius:8,barThickness:30}]};return(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 p-6 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl bg-white rounded-lg shadow-md p-6",children:[(0,t.jsx)("button",{className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-800 rounded-lg border border-gray-300 hover:bg-gray-200 mb-4",onClick:()=>e.push("/dashboard"),children:"Voltar ao Dashboard"}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Adicionar Nova Refei\xe7\xe3o"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"mealTime",className:"block text-sm font-medium text-gray-700",children:"Refei\xe7\xe3o"}),(0,t.jsxs)("select",{id:"mealTime",value:r,onChange:e=>l(e.target.value),className:"block w-full mt-1 p-2 border border-gray-300 rounded-lg",children:[(0,t.jsx)("option",{value:"Caf\xe9 da manh\xe3",children:"Caf\xe9 da manh\xe3"}),(0,t.jsx)("option",{value:"Almo\xe7o",children:"Almo\xe7o"}),(0,t.jsx)("option",{value:"Caf\xe9 da tarde",children:"Caf\xe9 da tarde"}),(0,t.jsx)("option",{value:"Lanche",children:"Lanche"}),(0,t.jsx)("option",{value:"Janta",children:"Janta"}),(0,t.jsx)("option",{value:"Beliscada",children:"Beliscada"})]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"dateTime",className:"block text-sm font-medium text-gray-700",children:"Data e Hora"}),(0,t.jsx)("input",{type:"datetime-local",id:"dateTime",value:n,onChange:e=>m(e.target.value),className:"block w-full p-2 border border-gray-300 rounded-lg"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Imagem da Refei\xe7\xe3o"}),(0,t.jsxs)("label",{className:"block cursor-pointer w-full border border-gray-400 rounded-lg bg-gray-200 text-center p-4",children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:k,className:"hidden"}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Clique aqui para adicionar uma imagem"})]}),h&&(0,t.jsx)("img",{src:h,alt:"Preview",className:"mt-4 w-full rounded-lg"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"ingredients",className:"block text-sm font-medium text-gray-700",children:"Ingredientes"}),(0,t.jsx)("textarea",{id:"ingredients",value:x,onChange:e=>p(e.target.value),className:"block w-full p-2 border border-gray-300 rounded-lg",rows:4}),(0,t.jsx)("button",{onClick:I,className:"mt-2 w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700",children:"Recalcular com IA"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"Editar Macronutrientes"}),Object.entries(v).map(e=>{let[a,r]=e;return(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 capitalize",children:a}),(0,t.jsx)("input",{type:"number",value:r,onChange:e=>w(r=>({...r,[a]:Number(e.target.value)})),className:"block w-full p-2 border border-gray-300 rounded-lg"})]},a)})]}),(0,t.jsxs)("div",{className:"my-6",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:"Resumo Nutricional"}),(0,t.jsx)(i.yP,{data:S,options:{indexAxis:"y",responsive:!0,scales:{x:{display:!1},y:{ticks:{font:{size:14}},grid:{display:!1}}},plugins:{legend:{display:!1}}}})]}),(0,t.jsx)("button",{className:"w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700",onClick:R,children:"Salvar Refei\xe7\xe3o"})]})})}l.t1.register(l.PP,l.kc,l.E8,l.m_)},8223:(e,a,r)=>{"use strict";r.d(a,{N:()=>t});let t=(0,r(5974).UU)("https://dtfcddxkcyznpnwnbcnq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0ZmNkZHhrY3l6bnBud25iY25xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ4NzgxMDYsImV4cCI6MjA1MDQ1NDEwNn0.nJ7aVk6V90HHMSiS9_b3Y_oF9uFX9nzOKyozSgmBQHQ")}},e=>{var a=a=>e(e.s=a);e.O(0,[647,385,759,441,517,358],()=>a(1176)),_N_E=e.O()}]);